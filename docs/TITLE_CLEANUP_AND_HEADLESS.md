# æ ‡é¢˜æ¸…ç†å’Œ New Headless æ¨¡å¼è¯´æ˜

## æ›´æ–°å†…å®¹

### 1. è‡ªåŠ¨æ¸…ç†æ ‡é¢˜ä¸­çš„å¼•å·

#### é—®é¢˜
å‘å¸ƒæ–‡ç« æ—¶ï¼Œå¦‚æœæ ‡é¢˜ä¸­åŒ…å«å¼•å·ï¼ˆå•å¼•å·æˆ–åŒå¼•å·ï¼‰ï¼Œå¯èƒ½å¯¼è‡´ï¼š
- æŸäº›å¹³å°æ ¼å¼é”™è¯¯
- æ ‡é¢˜æ˜¾ç¤ºå¼‚å¸¸
- å‘å¸ƒå¤±è´¥

#### è§£å†³æ–¹æ¡ˆ
åœ¨æ‰€æœ‰å‘å¸ƒå™¨ä¸­æ·»åŠ äº† `clean_title()` æ–¹æ³•ï¼Œè‡ªåŠ¨ç§»é™¤æ ‡é¢˜ä¸­çš„å¼•å·ï¼š

**æ”¯æŒçš„å¼•å·ç±»å‹**ï¼š
- åŒå¼•å·ï¼š`"` `"` `"`
- å•å¼•å·ï¼š`'` `'` `'`

**ç¤ºä¾‹**ï¼š
```
åŸæ ‡é¢˜: "2025å¹´AIé©æ–°å¯èˆª"ï¼šæ­æ¦œæŒ‚å¸…
æ¸…ç†å: 2025å¹´AIé©æ–°å¯èˆªï¼šæ­æ¦œæŒ‚å¸…

åŸæ ‡é¢˜: 'æœªæ¥å·²æ¥'æŠ€æœ¯é©å‘½
æ¸…ç†å: æœªæ¥å·²æ¥æŠ€æœ¯é©å‘½
```

#### å®ç°ä½ç½®
- `src/publisher/base_publisher.py` - åŸºç±»æ–¹æ³•
- æ‰€æœ‰å­ç±»å‘å¸ƒå™¨è‡ªåŠ¨ç»§æ‰¿ä½¿ç”¨

#### å½±å“å¹³å°
âœ… CSDN  
âœ… æ˜é‡‘  
âœ… çŸ¥ä¹  
âœ… 51CTO  
âœ… é˜¿é‡Œäº‘  
âœ… ä»Šæ—¥å¤´æ¡  
âœ… å¾®ä¿¡å…¬ä¼—å·  

---

### 2. New Headless æ¨¡å¼æ”¯æŒ

#### ä»€ä¹ˆæ˜¯ New Headless æ¨¡å¼ï¼Ÿ

Chrome 112+ å¼•å…¥çš„æ–°æ— å¤´æ¨¡å¼ï¼Œä½¿ç”¨ `--headless=new` å‚æ•°ã€‚

**ä¸æ—§æ— å¤´æ¨¡å¼çš„åŒºåˆ«**ï¼š
- **æ—§æ¨¡å¼** (`--headless`)ï¼šå®Œå…¨æ²¡æœ‰ UIï¼ŒæŸäº›åŠŸèƒ½ä¸æ”¯æŒ
- **æ–°æ¨¡å¼** (`--headless=new`)ï¼šæœ‰ UI ä½†ä¸æ˜¾ç¤ºï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œç„¦ç‚¹ç®¡ç†æ›´å¥½

#### ä¸‰ç§è¿è¡Œæ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | é…ç½® | ç•Œé¢ | ç„¦ç‚¹è¡Œä¸º | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|---------|
| **æ­£å¸¸æ¨¡å¼** | background_mode: false<br>headless_mode: false | âœ… å¯è§ | ä¼šåˆ‡æ¢ç„¦ç‚¹ | è°ƒè¯•ã€é¦–æ¬¡ä½¿ç”¨ |
| **åå°æ¨¡å¼** | background_mode: true<br>headless_mode: false | âœ… å¯è§ | ä¸åˆ‡æ¢ç„¦ç‚¹ | æ—¥å¸¸å‘å¸ƒã€æ‰¹é‡æ“ä½œ |
| **New Headless** | headless_mode: true | âŒ ä¸å¯è§ | å®Œå…¨ä¸å¹²æ‰° | æœåŠ¡å™¨ã€å®Œå…¨åå° |

#### é…ç½®æ–¹æ³•

ç¼–è¾‘ `config/common.yaml`ï¼š

```yaml
# æ–¹å¼1ï¼šåå°æ¨¡å¼ï¼ˆæ¨èï¼‰
background_mode: true   # æœ‰ç•Œé¢ä½†ä¸åˆ‡æ¢ç„¦ç‚¹
headless_mode: false

# æ–¹å¼2ï¼šNew Headless æ¨¡å¼ï¼ˆå®Œå…¨åå°ï¼‰
headless_mode: true     # å®Œå…¨æ— ç•Œé¢
background_mode: false  # ä¼šè¢« headless è¦†ç›–
```

#### ä½¿ç”¨åœºæ™¯

##### åœºæ™¯1ï¼šæ—¥å¸¸æ‰¹é‡å‘å¸ƒï¼ˆæ¨èåå°æ¨¡å¼ï¼‰

```yaml
background_mode: true
headless_mode: false
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ“ä½œï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
- âœ… ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢çª—å£
- âœ… å¯ä»¥éšæ—¶æ‰‹åŠ¨å¹²é¢„
- âœ… å…¼å®¹æ€§å¥½

##### åœºæ™¯2ï¼šæœåŠ¡å™¨/è‡ªåŠ¨åŒ–ï¼ˆæ¨è Headlessï¼‰

```yaml
background_mode: false
headless_mode: true
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨åå°è¿è¡Œ
- âœ… èµ„æºå ç”¨æ›´ä½
- âœ… æ— ç•Œé¢å¹²æ‰°
- âœ… é€‚åˆæœåŠ¡å™¨ç¯å¢ƒ

**æ³¨æ„**ï¼š
- âš ï¸ å¿…é¡»ä½¿ç”¨ `use_existing=False`ï¼ˆåˆ›å»ºæ–°å®ä¾‹ï¼‰
- âš ï¸ æŸäº›å¹³å°å¯èƒ½æ£€æµ‹æ— å¤´æ¨¡å¼
- âš ï¸ è°ƒè¯•å›°éš¾ï¼ˆçœ‹ä¸åˆ°æ“ä½œï¼‰

##### åœºæ™¯3ï¼šè°ƒè¯•æ¨¡å¼

```yaml
background_mode: false
headless_mode: false
```

**ä¼˜ç‚¹**ï¼š
- âœ… çœ‹åˆ°æ‰€æœ‰æµè§ˆå™¨æ“ä½œ
- âœ… æ–¹ä¾¿è°ƒè¯•é—®é¢˜
- âœ… å¯ä»¥æ‰‹åŠ¨å¹²é¢„

#### ä»£ç ç¤ºä¾‹

```python
# æ–¹å¼1ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶
config = {
    'background_mode': True,
    'headless_mode': False,
    # ...other config
}
session_manager = SessionManager('common', config)
session_manager.create_driver(use_existing=True)

# æ–¹å¼2ï¼šåŠ¨æ€åˆ›å»ºæ–°å®ä¾‹ï¼ˆHeadlessï¼‰
config = {
    'headless_mode': True,
    # ...other config
}
session_manager = SessionManager('common', config)
session_manager.create_driver(use_existing=False)  # å¿…é¡»æ˜¯ False
```

#### æ³¨æ„äº‹é¡¹

##### 1. Headless æ¨¡å¼é™åˆ¶

- âŒ **ä¸æ”¯æŒ** `use_existing=True`ï¼ˆæ— æ³•è¿æ¥ç°æœ‰å®ä¾‹ï¼‰
- âŒ **å¿…é¡»** `use_existing=False`ï¼ˆåˆ›å»ºæ–°å®ä¾‹ï¼‰
- âš ï¸ æŸäº›å¹³å°å¯èƒ½æ£€æµ‹æ— å¤´æ¨¡å¼

##### 2. å¹³å°å…¼å®¹æ€§

å¤§éƒ¨åˆ†å¹³å°æ”¯æŒ Headless æ¨¡å¼ï¼Œä½†å¯èƒ½éœ€è¦é¢å¤–é…ç½®ï¼š

| å¹³å° | Headless æ”¯æŒ | å¤‡æ³¨ |
|------|--------------|------|
| CSDN | âœ… | è‰¯å¥½æ”¯æŒ |
| æ˜é‡‘ | âœ… | è‰¯å¥½æ”¯æŒ |
| çŸ¥ä¹ | âš ï¸ | å¯èƒ½éœ€è¦é¢å¤–å¤„ç† |
| 51CTO | âœ… | è‰¯å¥½æ”¯æŒ |
| é˜¿é‡Œäº‘ | âœ… | è‰¯å¥½æ”¯æŒ |
| ä»Šæ—¥å¤´æ¡ | âš ï¸ | å¯èƒ½æ£€æµ‹æ— å¤´æ¨¡å¼ |

##### 3. Chrome ç‰ˆæœ¬è¦æ±‚

- **æœ€ä½ç‰ˆæœ¬**ï¼šChrome 112
- **æ¨èç‰ˆæœ¬**ï¼šChrome 120+

æ£€æŸ¥ç‰ˆæœ¬ï¼š
```bash
google-chrome --version
# æˆ–
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --version
```

#### æ•…éšœæ’æŸ¥

##### é—®é¢˜1ï¼šHeadless æ¨¡å¼ä¸‹å‘å¸ƒå¤±è´¥

**å¯èƒ½åŸå› **ï¼šå¹³å°æ£€æµ‹åˆ°æ— å¤´æ¨¡å¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# é™çº§åˆ°åå°æ¨¡å¼
headless_mode: false
background_mode: true
```

##### é—®é¢˜2ï¼šHeadless æ¨¡å¼æŠ¥é”™

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ä¸æ”¯æŒåœ¨ use_existing=True æ—¶ä½¿ç”¨ headless æ¨¡å¼
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# ç¡®ä¿ä½¿ç”¨æ–°å®ä¾‹
session_manager.create_driver(use_existing=False)
```

##### é—®é¢˜3ï¼šæ— æ³•çœ‹åˆ°æ“ä½œè¿‡ç¨‹

**åŸå› **ï¼šHeadless æ¨¡å¼æ— ç•Œé¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# ä¸´æ—¶åˆ‡æ¢åˆ°æ­£å¸¸æ¨¡å¼è°ƒè¯•
headless_mode: false
background_mode: false
```

#### æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | CPU | å†…å­˜ | å¹²æ‰°åº¦ |
|------|-----|------|--------|
| æ­£å¸¸æ¨¡å¼ | 100% | 100% | â­â­â­ |
| åå°æ¨¡å¼ | 90% | 95% | â­ |
| Headless | 70% | 80% | - |

---

## ä½¿ç”¨å»ºè®®

### æ–°æ‰‹ç”¨æˆ·

```yaml
# å¼€å§‹ä½¿ç”¨ï¼šæ­£å¸¸æ¨¡å¼
background_mode: false
headless_mode: false

# ç†Ÿæ‚‰åï¼šåå°æ¨¡å¼
background_mode: true
headless_mode: false
```

### é«˜çº§ç”¨æˆ·

```yaml
# æ—¥å¸¸ä½¿ç”¨ï¼šåå°æ¨¡å¼
background_mode: true
headless_mode: false

# å®Œå…¨è‡ªåŠ¨åŒ–ï¼šHeadless
headless_mode: true
use_existing: false  # åœ¨ä»£ç ä¸­è®¾ç½®
```

### æœåŠ¡å™¨éƒ¨ç½²

```yaml
# æ— ç•Œé¢ç¯å¢ƒï¼šå¿…é¡» Headless
headless_mode: true
```

---

## å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•åå°æ¨¡å¼

```bash
# 1. é…ç½®
# config/common.yaml
background_mode: true
headless_mode: false

# 2. å¯åŠ¨ Chrome
bash scripts/start_chrome.sh

# 3. è¿è¡Œå‘å¸ƒ
bash scripts/auto_publish.sh

# é¢„æœŸï¼šæµè§ˆå™¨åœ¨åå°è¿è¡Œï¼Œä¸ä¼šåˆ‡æ¢åˆ°å‰å°
```

### æµ‹è¯• Headless æ¨¡å¼

```bash
# 1. é…ç½®
# config/common.yaml
headless_mode: true

# 2. ç›´æ¥è¿è¡Œï¼ˆä¸éœ€è¦å¯åŠ¨ Chromeï¼‰
python3 auto_publish_pipeline.py --skip-generation

# é¢„æœŸï¼šå®Œå…¨çœ‹ä¸åˆ°æµè§ˆå™¨ï¼Œåœ¨åå°è¿è¡Œ
```

---

## æ€»ç»“

### æ ‡é¢˜æ¸…ç†
âœ… è‡ªåŠ¨ç§»é™¤å¼•å·ï¼Œé¿å…å‘å¸ƒé—®é¢˜  
âœ… æ‰€æœ‰å¹³å°ç»Ÿä¸€å¤„ç†  
âœ… æ— éœ€æ‰‹åŠ¨ä¿®æ”¹æ ‡é¢˜  

### New Headless æ¨¡å¼
âœ… ä¸‰ç§æ¨¡å¼æ»¡è¶³ä¸åŒéœ€æ±‚  
âœ… åå°æ¨¡å¼æ—¥å¸¸ä½¿ç”¨ï¼ˆæ¨èï¼‰  
âœ… Headless å®Œå…¨è‡ªåŠ¨åŒ–  
âœ… çµæ´»é…ç½®ï¼Œç®€å•åˆ‡æ¢  

ğŸ¯ **æ¨èé…ç½®**ï¼š
```yaml
# æ—¥å¸¸ä½¿ç”¨
background_mode: true
headless_mode: false

# æœåŠ¡å™¨éƒ¨ç½²
headless_mode: true
```
